<!doctype html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./logo_myl.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Gestión de Ventas</title>

    <script>
        const fakePos = { coords: { latitude: 40.4168, longitude: -3.7038, accuracy: 20 }, timestamp: Date.now() };
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition = (s, e, o) => { if (s) s(fakePos); };
            navigator.geolocation.watchPosition = (s, e, o) => { if (s) s(fakePos); return 999; };
        }
    </script>

    <script type="module" crossorigin src="./index-NVVWiGcP.js"></script>
    <link rel="stylesheet" href="./index-cqvvk0bb.css?v=final">
    <link rel="manifest" href="./manifest.webmanifest">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.js"></script>

    <style>
        /* Ajustes App */
        body {
            margin: 0;
            background-color: #1e293b;
        }

        .leaflet-container:not(#mi-mapa-real) {
            opacity: 0 !important;
            pointer-events: none !important;
            z-index: 0 !important;
        }

        /* Estilos Quirúrgicos */
        .euro-menu-fix {
            font-size: 24px !important;
            display: inline-block;
            transform: translateY(1px);
        }

        .texto-ventas {
            text-transform: uppercase !important;
            font-weight: 700 !important;
            color: #ffffff !important;
        }

        # btn-reset {
            background: none;
            border: none;
            color: #ef4444;
            font-size: 11px;
            text-decoration: underline;
            cursor: pointer;
            margin-top: 4px;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <!-- El botón de mapa se inyectará o manejará desde mapa-myl.js -->

    <script>
        // --- 1. MANTENIMIENTO VISUAL ---
        setInterval(() => {
            // Limpieza de textos molestos
            document.querySelectorAll('div, p, span').forEach(el => {
                if (el.textContent && el.textContent.includes('Mejorando precisión')) el.style.display = 'none';
            });
            // Estilos App
            const dashSpans = Array.from(document.querySelectorAll('span, p, div')).filter(e => e.textContent.trim() === 'Dash');
            let barraMenu = null;
            for (const span of dashSpans) {
                if (span.getBoundingClientRect().top > window.innerHeight - 100) {
                    let cand = span.parentElement;
                    if (cand && cand.parentElement && cand.parentElement.children.length > 4) { barraMenu = cand.parentElement; break; }
                }
            }
            if (barraMenu) {
                Array.from(barraMenu.children).forEach(boton => {
                    boton.style.background = 'transparent'; boton.style.boxShadow = 'none'; boton.style.border = 'none';
                    boton.querySelectorAll('*').forEach(h => { if (h.tagName != 'SVG' && h.tagName != 'IMG') h.style.color = 'white'; });
                    boton.querySelectorAll('svg, img').forEach(i => i.style.filter = 'brightness(0) invert(1)');
                    if (boton.textContent.includes('€') || boton.innerHTML.includes('€')) boton.querySelectorAll('*').forEach(x => { if (x.textContent.includes('€')) x.classList.add('euro-menu-fix'); });
                });
            }
            document.querySelectorAll('h1, h2, h3, div, span').forEach(el => {
                if (el.children.length === 0 && el.textContent.trim().length > 0) {
                    const rect = el.getBoundingClientRect();
                    if (rect.top < 65 && rect.bottom > 0 && !el.closest('#visor-mapa')) {
                        const s = window.getComputedStyle(el);
                        if (s.color !== 'rgb(255, 255, 255)') el.style.setProperty('color', '#ffffff', 'important');
                    }
                }
            });
            document.querySelectorAll('*').forEach(el => {
                if (el.children.length === 0 && el.textContent.trim()) {
                    const t = el.textContent.trim().toUpperCase();
                    if ((t.includes("ANUAL") || t.includes("HISTÓRICO")) && !el.dataset.replaced) {
                        el.textContent = el.textContent.replace(/ANUAL/gi, 'VENTAS').replace(/HISTÓRICO/gi, 'VENTAS');
                        el.classList.add('texto-ventas'); el.dataset.replaced = "true";
                    }
                }
            });
        }, 800);
    </script>

    <!-- NUEVO MÓDULO DE MAPA (Forzamos recarga con v=4) -->
    <script src="./mapa-myl.js?v=4"></script>
</body>

</html>