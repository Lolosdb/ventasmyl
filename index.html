<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./logo_MyL.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Ventas M&L" />
    <title>Gestión de Ventas</title>
    
    <script type="module" crossorigin src="./index-NVVWiGcP.js"></script>
    <link rel="stylesheet" crossorigin href="./index-cqvvk0bb.css">
    
    <link rel="manifest" href="./manifest.webmanifest">
    <script id="vite-plugin-pwa:register-sw" src="./borrar_registerSW.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <script>
      (function() {
        // Clave para la copia de seguridad independiente
        const BACKUP_KEY = 'mentaylimon_backup_years'; 

        function protectYears() {
          try {
            // 1. Buscamos dónde está guardando los datos la app
            Object.keys(localStorage).forEach(function(key) {
              const raw = localStorage.getItem(key);
              
              // Verificamos si esta caja tiene los datos de la app (busca "years" y corchetes)
              if (raw && raw.indexOf('years')!== -1 && raw.indexOf('[')!== -1) {
                const data = JSON.parse(raw);
                
                if (data.years && Array.isArray(data.years)) {
                  let years = data.years;
                  let modified = false;

                  // 2. RECUPERAR DATOS DE LA COPIA DE SEGURIDAD
                  // Si ya guardamos años en el pasado (ej. 2027), los recuperamos aquí
                  const backupRaw = localStorage.getItem(BACKUP_KEY);
                  if (backupRaw) {
                    const backupYears = JSON.parse(backupRaw);
                    backupYears.forEach(y => {
                      // Si el backup tiene un año que la app ha borrado, lo re-inyectamos
                      if (!years.includes(y)) {
                        years.push(y);
                        modified = true;
                      }
                    });
                  }

                  // 3. ASEGURAR SIEMPRE EL 2026 (Mínimo obligatorio)
                  if (!years.includes(2026)) {
                    years.push(2026);
                    modified = true;
                  }

                  // 4. GUARDAR CORRECCIONES EN LA APP
                  if (modified) {
                    years.sort((a, b) => b - a); // Ordenar (2027, 2026, 2025...)
                    data.years = years;
                    localStorage.setItem(key, JSON.stringify(data));
                    console.log("Sistema Guardián: Años restaurados exitosamente:", years);
                  }

                  // 5. ACTUALIZAR LA COPIA DE SEGURIDAD
                  // Guardamos la lista completa actual para protegerla de futuros reinicios
                  localStorage.setItem(BACKUP_KEY, JSON.stringify(years));
                }
              }
            });
          } catch (e) {
            // Silencio en caso de error para no detener la app
          }
        }

        // Ejecutar inmediatamente al cargar
        protectYears();

        // Ejecutar cada segundo para vigilar si la app intenta borrar los datos
        setInterval(protectYears, 1000);
      })();
    </script>
  </body>
</html>
